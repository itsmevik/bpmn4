{"ast":null,"code":"import inherits from 'inherits';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { is } from '../../../util/ModelUtil';\nexport default function EventBasedGatewayBehavior(eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n  /**\n   * Remove existing sequence flows of event-based target before connecting\n   * from event-based gateway.\n   */\n\n  this.preExecuted('connection.create', function (event) {\n    var context = event.context,\n        source = context.source,\n        target = context.target,\n        existingIncomingConnections = target.incoming.slice();\n\n    if (context.hints && context.hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (is(source, 'bpmn:EventBasedGateway') && target.incoming.length) {\n      existingIncomingConnections.filter(isSequenceFlow).forEach(function (sequenceFlow) {\n        modeling.removeConnection(sequenceFlow);\n      });\n    }\n  });\n  /**\n   *  After replacing shape with event-based gateway, remove incoming sequence\n   *  flows of event-based targets which do not belong to event-based gateway\n   *  source.\n   */\n\n  this.preExecuted('shape.replace', function (event) {\n    var newShape = event.context.newShape,\n        newShapeTargets,\n        newShapeTargetsIncomingSequenceFlows;\n\n    if (!is(newShape, 'bpmn:EventBasedGateway')) {\n      return;\n    }\n\n    newShapeTargets = newShape.outgoing.filter(isSequenceFlow).map(function (sequenceFlow) {\n      return sequenceFlow.target;\n    });\n    newShapeTargetsIncomingSequenceFlows = newShapeTargets.reduce(function (sequenceFlows, target) {\n      var incomingSequenceFlows = target.incoming.filter(isSequenceFlow);\n      return sequenceFlows.concat(incomingSequenceFlows);\n    }, []);\n    newShapeTargetsIncomingSequenceFlows.forEach(function (sequenceFlow) {\n      if (sequenceFlow.source !== newShape) {\n        modeling.removeConnection(sequenceFlow);\n      }\n    });\n  });\n}\nEventBasedGatewayBehavior.$inject = ['eventBus', 'modeling'];\ninherits(EventBasedGatewayBehavior, CommandInterceptor); // helpers //////////////////////\n\nfunction isSequenceFlow(connection) {\n  return is(connection, 'bpmn:SequenceFlow');\n}","map":{"version":3,"sources":["/Users/believecreative/Kumar/bpmn/node_modules/bpmn-js/lib/features/modeling/behavior/EventBasedGatewayBehavior.js"],"names":["inherits","CommandInterceptor","is","EventBasedGatewayBehavior","eventBus","modeling","call","preExecuted","event","context","source","target","existingIncomingConnections","incoming","slice","hints","createElementsBehavior","length","filter","isSequenceFlow","forEach","sequenceFlow","removeConnection","newShape","newShapeTargets","newShapeTargetsIncomingSequenceFlows","outgoing","map","reduce","sequenceFlows","incomingSequenceFlows","concat","$inject","connection"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,UAArB;AAEA,OAAOC,kBAAP,MAA+B,2CAA/B;AAEA,SAASC,EAAT,QAAmB,yBAAnB;AAEA,eAAe,SAASC,yBAAT,CAAmCC,QAAnC,EAA6CC,QAA7C,EAAuD;AAEpEJ,EAAAA,kBAAkB,CAACK,IAAnB,CAAwB,IAAxB,EAA8BF,QAA9B;AAEA;;;;;AAIA,OAAKG,WAAL,CAAiB,mBAAjB,EAAsC,UAASC,KAAT,EAAgB;AAEpD,QAAIC,OAAO,GAAGD,KAAK,CAACC,OAApB;AAAA,QACIC,MAAM,GAAGD,OAAO,CAACC,MADrB;AAAA,QAEIC,MAAM,GAAGF,OAAO,CAACE,MAFrB;AAAA,QAGIC,2BAA2B,GAAGD,MAAM,CAACE,QAAP,CAAgBC,KAAhB,EAHlC;;AAKA,QAAIL,OAAO,CAACM,KAAR,IAAiBN,OAAO,CAACM,KAAR,CAAcC,sBAAd,KAAyC,KAA9D,EAAqE;AACnE;AACD;;AAED,QACEd,EAAE,CAACQ,MAAD,EAAS,wBAAT,CAAF,IACAC,MAAM,CAACE,QAAP,CAAgBI,MAFlB,EAGE;AAEAL,MAAAA,2BAA2B,CAACM,MAA5B,CAAmCC,cAAnC,EACGC,OADH,CACW,UAASC,YAAT,EAAuB;AAC9BhB,QAAAA,QAAQ,CAACiB,gBAAT,CAA0BD,YAA1B;AACD,OAHH;AAID;AACF,GArBD;AAuBA;;;;;;AAKA,OAAKd,WAAL,CAAiB,eAAjB,EAAkC,UAASC,KAAT,EAAgB;AAEhD,QAAIe,QAAQ,GAAGf,KAAK,CAACC,OAAN,CAAcc,QAA7B;AAAA,QACIC,eADJ;AAAA,QAEIC,oCAFJ;;AAIA,QAAI,CAACvB,EAAE,CAACqB,QAAD,EAAW,wBAAX,CAAP,EAA6C;AAC3C;AACD;;AAEDC,IAAAA,eAAe,GAAGD,QAAQ,CAACG,QAAT,CAAkBR,MAAlB,CAAyBC,cAAzB,EACfQ,GADe,CACX,UAASN,YAAT,EAAuB;AAC1B,aAAOA,YAAY,CAACV,MAApB;AACD,KAHe,CAAlB;AAKAc,IAAAA,oCAAoC,GAAGD,eAAe,CAACI,MAAhB,CAAuB,UAASC,aAAT,EAAwBlB,MAAxB,EAAgC;AAC5F,UAAImB,qBAAqB,GAAGnB,MAAM,CAACE,QAAP,CAAgBK,MAAhB,CAAuBC,cAAvB,CAA5B;AAEA,aAAOU,aAAa,CAACE,MAAd,CAAqBD,qBAArB,CAAP;AACD,KAJsC,EAIpC,EAJoC,CAAvC;AAMAL,IAAAA,oCAAoC,CAACL,OAArC,CAA6C,UAASC,YAAT,EAAuB;AAClE,UAAIA,YAAY,CAACX,MAAb,KAAwBa,QAA5B,EAAsC;AACpClB,QAAAA,QAAQ,CAACiB,gBAAT,CAA0BD,YAA1B;AACD;AACF,KAJD;AAKD,GA1BD;AA2BD;AAEDlB,yBAAyB,CAAC6B,OAA1B,GAAoC,CAClC,UADkC,EAElC,UAFkC,CAApC;AAKAhC,QAAQ,CAACG,yBAAD,EAA4BF,kBAA5B,CAAR,C,CAIA;;AAEA,SAASkB,cAAT,CAAwBc,UAAxB,EAAoC;AAClC,SAAO/B,EAAE,CAAC+B,UAAD,EAAa,mBAAb,CAAT;AACD","sourcesContent":["import inherits from 'inherits';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nexport default function EventBasedGatewayBehavior(eventBus, modeling) {\n\n  CommandInterceptor.call(this, eventBus);\n\n  /**\n   * Remove existing sequence flows of event-based target before connecting\n   * from event-based gateway.\n   */\n  this.preExecuted('connection.create', function(event) {\n\n    var context = event.context,\n        source = context.source,\n        target = context.target,\n        existingIncomingConnections = target.incoming.slice();\n\n    if (context.hints && context.hints.createElementsBehavior === false) {\n      return;\n    }\n\n    if (\n      is(source, 'bpmn:EventBasedGateway') &&\n      target.incoming.length\n    ) {\n\n      existingIncomingConnections.filter(isSequenceFlow)\n        .forEach(function(sequenceFlow) {\n          modeling.removeConnection(sequenceFlow);\n        });\n    }\n  });\n\n  /**\n   *  After replacing shape with event-based gateway, remove incoming sequence\n   *  flows of event-based targets which do not belong to event-based gateway\n   *  source.\n   */\n  this.preExecuted('shape.replace', function(event) {\n\n    var newShape = event.context.newShape,\n        newShapeTargets,\n        newShapeTargetsIncomingSequenceFlows;\n\n    if (!is(newShape, 'bpmn:EventBasedGateway')) {\n      return;\n    }\n\n    newShapeTargets = newShape.outgoing.filter(isSequenceFlow)\n      .map(function(sequenceFlow) {\n        return sequenceFlow.target;\n      });\n\n    newShapeTargetsIncomingSequenceFlows = newShapeTargets.reduce(function(sequenceFlows, target) {\n      var incomingSequenceFlows = target.incoming.filter(isSequenceFlow);\n\n      return sequenceFlows.concat(incomingSequenceFlows);\n    }, []);\n\n    newShapeTargetsIncomingSequenceFlows.forEach(function(sequenceFlow) {\n      if (sequenceFlow.source !== newShape) {\n        modeling.removeConnection(sequenceFlow);\n      }\n    });\n  });\n}\n\nEventBasedGatewayBehavior.$inject = [\n  'eventBus',\n  'modeling'\n];\n\ninherits(EventBasedGatewayBehavior, CommandInterceptor);\n\n\n\n// helpers //////////////////////\n\nfunction isSequenceFlow(connection) {\n  return is(connection, 'bpmn:SequenceFlow');\n}\n"]},"metadata":{},"sourceType":"module"}