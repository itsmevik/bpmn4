{"ast":null,"code":"import inherits from 'inherits';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { getBusinessObject } from '../../../util/ModelUtil';\nimport { isAny } from '../util/ModelingUtil';\nimport { isLabel } from '../../../util/LabelUtil';\nvar LOW_PRIORITY = 500;\n/**\n * Replace intermediate event with boundary event when creating or moving results in attached event.\n */\n\nexport default function AttachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n  this._bpmnReplace = bpmnReplace;\n  var self = this;\n  this.postExecuted('elements.create', LOW_PRIORITY, function (context) {\n    var elements = context.elements;\n    elements = elements.filter(function (shape) {\n      var host = shape.host;\n      return shouldReplace(shape, host);\n    });\n\n    if (elements.length !== 1) {\n      return;\n    }\n\n    elements.map(function (element) {\n      return elements.indexOf(element);\n    }).forEach(function (index) {\n      var host = elements[index];\n      context.elements[index] = self.replaceShape(elements[index], host);\n    });\n  }, true);\n  this.preExecute('elements.move', LOW_PRIORITY, function (context) {\n    var shapes = context.shapes,\n        host = context.newHost;\n\n    if (shapes.length !== 1) {\n      return;\n    }\n\n    var shape = shapes[0];\n\n    if (shouldReplace(shape, host)) {\n      context.shapes = [self.replaceShape(shape, host)];\n    }\n  }, true);\n}\nAttachEventBehavior.$inject = ['bpmnReplace', 'injector'];\ninherits(AttachEventBehavior, CommandInterceptor);\n\nAttachEventBehavior.prototype.replaceShape = function (shape, host) {\n  var eventDefinition = getEventDefinition(shape);\n  var boundaryEvent = {\n    type: 'bpmn:BoundaryEvent',\n    host: host\n  };\n\n  if (eventDefinition) {\n    boundaryEvent.eventDefinitionType = eventDefinition.$type;\n  }\n\n  return this._bpmnReplace.replaceElement(shape, boundaryEvent, {\n    layoutConnection: false\n  });\n}; // helpers //////////\n\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n      eventDefinitions = businessObject.eventDefinitions;\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) && isAny(shape, ['bpmn:IntermediateThrowEvent', 'bpmn:IntermediateCatchEvent']) && !!host;\n}","map":{"version":3,"sources":["/Users/believecreative/Kumar/bpmn/node_modules/bpmn-js/lib/features/modeling/behavior/AttachEventBehavior.js"],"names":["inherits","CommandInterceptor","getBusinessObject","isAny","isLabel","LOW_PRIORITY","AttachEventBehavior","bpmnReplace","injector","invoke","_bpmnReplace","self","postExecuted","context","elements","filter","shape","host","shouldReplace","length","map","element","indexOf","forEach","index","replaceShape","preExecute","shapes","newHost","$inject","prototype","eventDefinition","getEventDefinition","boundaryEvent","type","eventDefinitionType","$type","replaceElement","layoutConnection","businessObject","eventDefinitions"],"mappings":"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","sourcesContent":["import inherits from 'inherits';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { getBusinessObject } from '../../../util/ModelUtil';\n\nimport { isAny } from '../util/ModelingUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\nvar LOW_PRIORITY = 500;\n\n\n/**\n * Replace intermediate event with boundary event when creating or moving results in attached event.\n */\nexport default function AttachEventBehavior(bpmnReplace, injector) {\n  injector.invoke(CommandInterceptor, this);\n\n  this._bpmnReplace = bpmnReplace;\n\n  var self = this;\n\n  this.postExecuted('elements.create', LOW_PRIORITY, function(context) {\n    var elements = context.elements;\n\n    elements = elements.filter(function(shape) {\n      var host = shape.host;\n\n      return shouldReplace(shape, host);\n    });\n\n    if (elements.length !== 1) {\n      return;\n    }\n\n    elements.map(function(element) {\n      return elements.indexOf(element);\n    }).forEach(function(index) {\n      var host = elements[ index ];\n\n      context.elements[ index ] = self.replaceShape(elements[ index ], host);\n    });\n  }, true);\n\n\n  this.preExecute('elements.move', LOW_PRIORITY, function(context) {\n    var shapes = context.shapes,\n        host = context.newHost;\n\n    if (shapes.length !== 1) {\n      return;\n    }\n\n    var shape = shapes[0];\n\n    if (shouldReplace(shape, host)) {\n      context.shapes = [ self.replaceShape(shape, host) ];\n    }\n  }, true);\n}\n\nAttachEventBehavior.$inject = [\n  'bpmnReplace',\n  'injector'\n];\n\ninherits(AttachEventBehavior, CommandInterceptor);\n\nAttachEventBehavior.prototype.replaceShape = function(shape, host) {\n  var eventDefinition = getEventDefinition(shape);\n\n  var boundaryEvent = {\n    type: 'bpmn:BoundaryEvent',\n    host: host\n  };\n\n  if (eventDefinition) {\n    boundaryEvent.eventDefinitionType = eventDefinition.$type;\n  }\n\n  return this._bpmnReplace.replaceElement(shape, boundaryEvent, { layoutConnection: false });\n};\n\n\n// helpers //////////\n\nfunction getEventDefinition(element) {\n  var businessObject = getBusinessObject(element),\n      eventDefinitions = businessObject.eventDefinitions;\n\n  return eventDefinitions && eventDefinitions[0];\n}\n\nfunction shouldReplace(shape, host) {\n  return !isLabel(shape) &&\n    isAny(shape, [ 'bpmn:IntermediateThrowEvent', 'bpmn:IntermediateCatchEvent' ]) && !!host;\n}\n"]},"metadata":{},"sourceType":"module"}