{"ast":null,"code":"import inherits from 'inherits';\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\nimport { is } from '../../../util/ModelUtil';\nimport { isLabel } from '../../../util/LabelUtil';\nimport { getBBox } from 'diagram-js/lib/util/Elements';\nimport { assign, find } from 'min-dash';\nimport { asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\nvar HORIZONTAL_PARTICIPANT_PADDING = 20,\n    VERTICAL_PARTICIPANT_PADDING = 20;\nexport var PARTICIPANT_BORDER_WIDTH = 30;\nvar HIGH_PRIORITY = 2000;\n/**\n * BPMN-specific behavior for creating participants.\n */\n\nexport default function CreateParticipantBehavior(canvas, eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus); // fit participant\n\n  eventBus.on(['create.start', 'shape.move.start'], HIGH_PRIORITY, function (event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement();\n\n    if (!is(shape, 'bpmn:Participant') || !is(rootElement, 'bpmn:Process') || !rootElement.children.length) {\n      return;\n    } // ignore connections, groups and labels\n\n\n    var children = rootElement.children.filter(function (element) {\n      return !is(element, 'bpmn:Group') && !isLabel(element) && !isConnection(element);\n    }); // ensure for available children to calculate bounds\n\n    if (!children.length) {\n      return;\n    }\n\n    var childrenBBox = getBBox(children);\n    var participantBounds = getParticipantBounds(shape, childrenBBox); // assign width and height\n\n    assign(shape, participantBounds); // assign create constraints\n\n    context.createConstraints = getParticipantCreateConstraints(shape, childrenBBox);\n  }); // force hovering process when creating first participant\n\n  eventBus.on('create.start', HIGH_PRIORITY, function (event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement(),\n        rootElementGfx = canvas.getGraphics(rootElement);\n\n    function ensureHoveringProcess(event) {\n      event.element = rootElement;\n      event.gfx = rootElementGfx;\n    }\n\n    if (is(shape, 'bpmn:Participant') && is(rootElement, 'bpmn:Process')) {\n      eventBus.on('element.hover', HIGH_PRIORITY, ensureHoveringProcess);\n      eventBus.once('create.cleanup', function () {\n        eventBus.off('element.hover', ensureHoveringProcess);\n      });\n    }\n  });\n\n  function ensureCollaboration(context) {\n    var parent = context.parent,\n        collaboration;\n    var rootElement = canvas.getRootElement();\n\n    if (is(rootElement, 'bpmn:Collaboration')) {\n      collaboration = rootElement;\n    } else {\n      // update root element by making collaboration\n      collaboration = modeling.makeCollaboration(); // re-use process when creating first participant\n\n      context.process = parent;\n    }\n\n    context.parent = collaboration;\n  } // turn process into collaboration before adding participant\n\n\n  this.preExecute('shape.create', function (context) {\n    var parent = context.parent,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:Participant') && is(parent, 'bpmn:Process')) {\n      ensureCollaboration(context);\n    }\n  }, true);\n  this.execute('shape.create', function (context) {\n    var process = context.process,\n        shape = context.shape;\n\n    if (process) {\n      context.oldProcessRef = shape.businessObject.processRef; // re-use process when creating first participant\n\n      shape.businessObject.processRef = process.businessObject;\n    }\n  }, true);\n  this.revert('shape.create', function (context) {\n    var process = context.process,\n        shape = context.shape;\n\n    if (process) {\n      // re-use process when creating first participant\n      shape.businessObject.processRef = context.oldProcessRef;\n    }\n  }, true);\n  this.postExecute('shape.create', function (context) {\n    var process = context.process,\n        shape = context.shape;\n\n    if (process) {\n      // move children from process to participant\n      var processChildren = process.children.slice();\n      modeling.moveElements(processChildren, {\n        x: 0,\n        y: 0\n      }, shape);\n    }\n  }, true); // turn process into collaboration when creating participants\n\n  this.preExecute('elements.create', HIGH_PRIORITY, function (context) {\n    var elements = context.elements,\n        parent = context.parent,\n        participant;\n    var hasParticipants = findParticipant(elements);\n\n    if (hasParticipants && is(parent, 'bpmn:Process')) {\n      ensureCollaboration(context);\n      participant = findParticipant(elements);\n      context.oldProcessRef = participant.businessObject.processRef; // re-use process when creating first participant\n\n      participant.businessObject.processRef = parent.businessObject;\n    }\n  }, true);\n  this.revert('elements.create', function (context) {\n    var elements = context.elements,\n        process = context.process,\n        participant;\n\n    if (process) {\n      participant = findParticipant(elements); // re-use process when creating first participant\n\n      participant.businessObject.processRef = context.oldProcessRef;\n    }\n  }, true);\n  this.postExecute('elements.create', function (context) {\n    var elements = context.elements,\n        process = context.process,\n        participant;\n\n    if (process) {\n      participant = findParticipant(elements); // move children from process to first participant\n\n      var processChildren = process.children.slice();\n      modeling.moveElements(processChildren, {\n        x: 0,\n        y: 0\n      }, participant);\n    }\n  }, true);\n}\nCreateParticipantBehavior.$inject = ['canvas', 'eventBus', 'modeling'];\ninherits(CreateParticipantBehavior, CommandInterceptor); // helpers //////////\n\nfunction getParticipantBounds(shape, childrenBBox) {\n  childrenBBox = {\n    width: childrenBBox.width + HORIZONTAL_PARTICIPANT_PADDING * 2 + PARTICIPANT_BORDER_WIDTH,\n    height: childrenBBox.height + VERTICAL_PARTICIPANT_PADDING * 2\n  };\n  var width = Math.max(shape.width, childrenBBox.width),\n      height = Math.max(shape.height, childrenBBox.height);\n  return {\n    x: -width / 2,\n    y: -height / 2,\n    width: width,\n    height: height\n  };\n}\n\nfunction getParticipantCreateConstraints(shape, childrenBBox) {\n  childrenBBox = asTRBL(childrenBBox);\n  return {\n    bottom: childrenBBox.top + shape.height / 2 - VERTICAL_PARTICIPANT_PADDING,\n    left: childrenBBox.right - shape.width / 2 + HORIZONTAL_PARTICIPANT_PADDING,\n    top: childrenBBox.bottom - shape.height / 2 + VERTICAL_PARTICIPANT_PADDING,\n    right: childrenBBox.left + shape.width / 2 - HORIZONTAL_PARTICIPANT_PADDING - PARTICIPANT_BORDER_WIDTH\n  };\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}\n\nfunction findParticipant(elements) {\n  return find(elements, function (element) {\n    return is(element, 'bpmn:Participant');\n  });\n}","map":{"version":3,"sources":["/Users/believecreative/Kumar/bpmn/node_modules/bpmn-js/lib/features/modeling/behavior/CreateParticipantBehavior.js"],"names":["inherits","CommandInterceptor","is","isLabel","getBBox","assign","find","asTRBL","HORIZONTAL_PARTICIPANT_PADDING","VERTICAL_PARTICIPANT_PADDING","PARTICIPANT_BORDER_WIDTH","HIGH_PRIORITY","CreateParticipantBehavior","canvas","eventBus","modeling","call","on","event","context","shape","rootElement","getRootElement","children","length","filter","element","isConnection","childrenBBox","participantBounds","getParticipantBounds","createConstraints","getParticipantCreateConstraints","rootElementGfx","getGraphics","ensureHoveringProcess","gfx","once","off","ensureCollaboration","parent","collaboration","makeCollaboration","process","preExecute","execute","oldProcessRef","businessObject","processRef","revert","postExecute","processChildren","slice","moveElements","x","y","elements","participant","hasParticipants","findParticipant","$inject","width","height","Math","max","bottom","top","left","right","waypoints"],"mappings":"AAAA,OAAOA,QAAP,MAAqB,UAArB;AAEA,OAAOC,kBAAP,MAA+B,2CAA/B;AAEA,SAASC,EAAT,QAAmB,yBAAnB;AAEA,SAASC,OAAT,QAAwB,yBAAxB;AAEA,SAASC,OAAT,QAAwB,8BAAxB;AAEA,SACEC,MADF,EAEEC,IAFF,QAGO,UAHP;AAKA,SAASC,MAAT,QAAuB,kCAAvB;AAEA,IAAIC,8BAA8B,GAAG,EAArC;AAAA,IACIC,4BAA4B,GAAG,EADnC;AAGA,OAAO,IAAIC,wBAAwB,GAAG,EAA/B;AAEP,IAAIC,aAAa,GAAG,IAApB;AAGA;;;;AAGA,eAAe,SAASC,yBAAT,CAAmCC,MAAnC,EAA2CC,QAA3C,EAAqDC,QAArD,EAA+D;AAC5Ed,EAAAA,kBAAkB,CAACe,IAAnB,CAAwB,IAAxB,EAA8BF,QAA9B,EAD4E,CAG5E;;AACAA,EAAAA,QAAQ,CAACG,EAAT,CAAY,CACV,cADU,EAEV,kBAFU,CAAZ,EAGGN,aAHH,EAGkB,UAASO,KAAT,EAAgB;AAChC,QAAIC,OAAO,GAAGD,KAAK,CAACC,OAApB;AAAA,QACIC,KAAK,GAAGD,OAAO,CAACC,KADpB;AAAA,QAEIC,WAAW,GAAGR,MAAM,CAACS,cAAP,EAFlB;;AAIA,QAAI,CAACpB,EAAE,CAACkB,KAAD,EAAQ,kBAAR,CAAH,IACF,CAAClB,EAAE,CAACmB,WAAD,EAAc,cAAd,CADD,IAEF,CAACA,WAAW,CAACE,QAAZ,CAAqBC,MAFxB,EAEgC;AAC9B;AACD,KAT+B,CAWhC;;;AACA,QAAID,QAAQ,GAAGF,WAAW,CAACE,QAAZ,CAAqBE,MAArB,CAA4B,UAASC,OAAT,EAAkB;AAC3D,aAAO,CAACxB,EAAE,CAACwB,OAAD,EAAU,YAAV,CAAH,IACL,CAACvB,OAAO,CAACuB,OAAD,CADH,IAEL,CAACC,YAAY,CAACD,OAAD,CAFf;AAGD,KAJc,CAAf,CAZgC,CAkBhC;;AACA,QAAI,CAACH,QAAQ,CAACC,MAAd,EAAsB;AACpB;AACD;;AAED,QAAII,YAAY,GAAGxB,OAAO,CAACmB,QAAD,CAA1B;AAEA,QAAIM,iBAAiB,GAAGC,oBAAoB,CAACV,KAAD,EAAQQ,YAAR,CAA5C,CAzBgC,CA2BhC;;AACAvB,IAAAA,MAAM,CAACe,KAAD,EAAQS,iBAAR,CAAN,CA5BgC,CA8BhC;;AACAV,IAAAA,OAAO,CAACY,iBAAR,GAA4BC,+BAA+B,CAACZ,KAAD,EAAQQ,YAAR,CAA3D;AACD,GAnCD,EAJ4E,CAyC5E;;AACAd,EAAAA,QAAQ,CAACG,EAAT,CAAY,cAAZ,EAA4BN,aAA5B,EAA2C,UAASO,KAAT,EAAgB;AACzD,QAAIC,OAAO,GAAGD,KAAK,CAACC,OAApB;AAAA,QACIC,KAAK,GAAGD,OAAO,CAACC,KADpB;AAAA,QAEIC,WAAW,GAAGR,MAAM,CAACS,cAAP,EAFlB;AAAA,QAGIW,cAAc,GAAGpB,MAAM,CAACqB,WAAP,CAAmBb,WAAnB,CAHrB;;AAKA,aAASc,qBAAT,CAA+BjB,KAA/B,EAAsC;AACpCA,MAAAA,KAAK,CAACQ,OAAN,GAAgBL,WAAhB;AACAH,MAAAA,KAAK,CAACkB,GAAN,GAAYH,cAAZ;AACD;;AAED,QAAI/B,EAAE,CAACkB,KAAD,EAAQ,kBAAR,CAAF,IAAiClB,EAAE,CAACmB,WAAD,EAAc,cAAd,CAAvC,EAAsE;AACpEP,MAAAA,QAAQ,CAACG,EAAT,CAAY,eAAZ,EAA6BN,aAA7B,EAA4CwB,qBAA5C;AAEArB,MAAAA,QAAQ,CAACuB,IAAT,CAAc,gBAAd,EAAgC,YAAW;AACzCvB,QAAAA,QAAQ,CAACwB,GAAT,CAAa,eAAb,EAA8BH,qBAA9B;AACD,OAFD;AAGD;AACF,GAlBD;;AAoBA,WAASI,mBAAT,CAA6BpB,OAA7B,EAAsC;AACpC,QAAIqB,MAAM,GAAGrB,OAAO,CAACqB,MAArB;AAAA,QACIC,aADJ;AAGA,QAAIpB,WAAW,GAAGR,MAAM,CAACS,cAAP,EAAlB;;AAEA,QAAIpB,EAAE,CAACmB,WAAD,EAAc,oBAAd,CAAN,EAA2C;AACzCoB,MAAAA,aAAa,GAAGpB,WAAhB;AACD,KAFD,MAEO;AAEL;AACAoB,MAAAA,aAAa,GAAG1B,QAAQ,CAAC2B,iBAAT,EAAhB,CAHK,CAKL;;AACAvB,MAAAA,OAAO,CAACwB,OAAR,GAAkBH,MAAlB;AACD;;AAEDrB,IAAAA,OAAO,CAACqB,MAAR,GAAiBC,aAAjB;AACD,GAhF2E,CAkF5E;;;AACA,OAAKG,UAAL,CAAgB,cAAhB,EAAgC,UAASzB,OAAT,EAAkB;AAChD,QAAIqB,MAAM,GAAGrB,OAAO,CAACqB,MAArB;AAAA,QACIpB,KAAK,GAAGD,OAAO,CAACC,KADpB;;AAGA,QAAIlB,EAAE,CAACkB,KAAD,EAAQ,kBAAR,CAAF,IAAiClB,EAAE,CAACsC,MAAD,EAAS,cAAT,CAAvC,EAAiE;AAC/DD,MAAAA,mBAAmB,CAACpB,OAAD,CAAnB;AACD;AACF,GAPD,EAOG,IAPH;AASA,OAAK0B,OAAL,CAAa,cAAb,EAA6B,UAAS1B,OAAT,EAAkB;AAC7C,QAAIwB,OAAO,GAAGxB,OAAO,CAACwB,OAAtB;AAAA,QACIvB,KAAK,GAAGD,OAAO,CAACC,KADpB;;AAGA,QAAIuB,OAAJ,EAAa;AACXxB,MAAAA,OAAO,CAAC2B,aAAR,GAAwB1B,KAAK,CAAC2B,cAAN,CAAqBC,UAA7C,CADW,CAGX;;AACA5B,MAAAA,KAAK,CAAC2B,cAAN,CAAqBC,UAArB,GAAkCL,OAAO,CAACI,cAA1C;AACD;AACF,GAVD,EAUG,IAVH;AAYA,OAAKE,MAAL,CAAY,cAAZ,EAA4B,UAAS9B,OAAT,EAAkB;AAC5C,QAAIwB,OAAO,GAAGxB,OAAO,CAACwB,OAAtB;AAAA,QACIvB,KAAK,GAAGD,OAAO,CAACC,KADpB;;AAGA,QAAIuB,OAAJ,EAAa;AAEX;AACAvB,MAAAA,KAAK,CAAC2B,cAAN,CAAqBC,UAArB,GAAkC7B,OAAO,CAAC2B,aAA1C;AACD;AACF,GATD,EASG,IATH;AAWA,OAAKI,WAAL,CAAiB,cAAjB,EAAiC,UAAS/B,OAAT,EAAkB;AACjD,QAAIwB,OAAO,GAAGxB,OAAO,CAACwB,OAAtB;AAAA,QACIvB,KAAK,GAAGD,OAAO,CAACC,KADpB;;AAGA,QAAIuB,OAAJ,EAAa;AAEX;AACA,UAAIQ,eAAe,GAAGR,OAAO,CAACpB,QAAR,CAAiB6B,KAAjB,EAAtB;AAEArC,MAAAA,QAAQ,CAACsC,YAAT,CAAsBF,eAAtB,EAAuC;AAAEG,QAAAA,CAAC,EAAE,CAAL;AAAQC,QAAAA,CAAC,EAAE;AAAX,OAAvC,EAAuDnC,KAAvD;AACD;AAEF,GAZD,EAYG,IAZH,EAnH4E,CAiI5E;;AACA,OAAKwB,UAAL,CAAgB,iBAAhB,EAAmCjC,aAAnC,EAAkD,UAASQ,OAAT,EAAkB;AAClE,QAAIqC,QAAQ,GAAGrC,OAAO,CAACqC,QAAvB;AAAA,QACIhB,MAAM,GAAGrB,OAAO,CAACqB,MADrB;AAAA,QAEIiB,WAFJ;AAIA,QAAIC,eAAe,GAAGC,eAAe,CAACH,QAAD,CAArC;;AAEA,QAAIE,eAAe,IAAIxD,EAAE,CAACsC,MAAD,EAAS,cAAT,CAAzB,EAAmD;AACjDD,MAAAA,mBAAmB,CAACpB,OAAD,CAAnB;AAEAsC,MAAAA,WAAW,GAAGE,eAAe,CAACH,QAAD,CAA7B;AAEArC,MAAAA,OAAO,CAAC2B,aAAR,GAAwBW,WAAW,CAACV,cAAZ,CAA2BC,UAAnD,CALiD,CAOjD;;AACAS,MAAAA,WAAW,CAACV,cAAZ,CAA2BC,UAA3B,GAAwCR,MAAM,CAACO,cAA/C;AACD;AACF,GAjBD,EAiBG,IAjBH;AAmBA,OAAKE,MAAL,CAAY,iBAAZ,EAA+B,UAAS9B,OAAT,EAAkB;AAC/C,QAAIqC,QAAQ,GAAGrC,OAAO,CAACqC,QAAvB;AAAA,QACIb,OAAO,GAAGxB,OAAO,CAACwB,OADtB;AAAA,QAEIc,WAFJ;;AAIA,QAAId,OAAJ,EAAa;AACXc,MAAAA,WAAW,GAAGE,eAAe,CAACH,QAAD,CAA7B,CADW,CAGX;;AACAC,MAAAA,WAAW,CAACV,cAAZ,CAA2BC,UAA3B,GAAwC7B,OAAO,CAAC2B,aAAhD;AACD;AACF,GAXD,EAWG,IAXH;AAaA,OAAKI,WAAL,CAAiB,iBAAjB,EAAoC,UAAS/B,OAAT,EAAkB;AACpD,QAAIqC,QAAQ,GAAGrC,OAAO,CAACqC,QAAvB;AAAA,QACIb,OAAO,GAAGxB,OAAO,CAACwB,OADtB;AAAA,QAEIc,WAFJ;;AAIA,QAAId,OAAJ,EAAa;AACXc,MAAAA,WAAW,GAAGE,eAAe,CAACH,QAAD,CAA7B,CADW,CAGX;;AACA,UAAIL,eAAe,GAAGR,OAAO,CAACpB,QAAR,CAAiB6B,KAAjB,EAAtB;AAEArC,MAAAA,QAAQ,CAACsC,YAAT,CAAsBF,eAAtB,EAAuC;AAAEG,QAAAA,CAAC,EAAE,CAAL;AAAQC,QAAAA,CAAC,EAAE;AAAX,OAAvC,EAAuDE,WAAvD;AACD;AAEF,GAdD,EAcG,IAdH;AAgBD;AAED7C,yBAAyB,CAACgD,OAA1B,GAAoC,CAClC,QADkC,EAElC,UAFkC,EAGlC,UAHkC,CAApC;AAMA5D,QAAQ,CAACY,yBAAD,EAA4BX,kBAA5B,CAAR,C,CAEA;;AAEA,SAAS6B,oBAAT,CAA8BV,KAA9B,EAAqCQ,YAArC,EAAmD;AACjDA,EAAAA,YAAY,GAAG;AACbiC,IAAAA,KAAK,EAAEjC,YAAY,CAACiC,KAAb,GAAqBrD,8BAA8B,GAAG,CAAtD,GAA0DE,wBADpD;AAEboD,IAAAA,MAAM,EAAElC,YAAY,CAACkC,MAAb,GAAsBrD,4BAA4B,GAAG;AAFhD,GAAf;AAKA,MAAIoD,KAAK,GAAGE,IAAI,CAACC,GAAL,CAAS5C,KAAK,CAACyC,KAAf,EAAsBjC,YAAY,CAACiC,KAAnC,CAAZ;AAAA,MACIC,MAAM,GAAGC,IAAI,CAACC,GAAL,CAAS5C,KAAK,CAAC0C,MAAf,EAAuBlC,YAAY,CAACkC,MAApC,CADb;AAGA,SAAO;AACLR,IAAAA,CAAC,EAAE,CAACO,KAAD,GAAS,CADP;AAELN,IAAAA,CAAC,EAAE,CAACO,MAAD,GAAU,CAFR;AAGLD,IAAAA,KAAK,EAAEA,KAHF;AAILC,IAAAA,MAAM,EAAEA;AAJH,GAAP;AAMD;;AAED,SAAS9B,+BAAT,CAAyCZ,KAAzC,EAAgDQ,YAAhD,EAA8D;AAC5DA,EAAAA,YAAY,GAAGrB,MAAM,CAACqB,YAAD,CAArB;AAEA,SAAO;AACLqC,IAAAA,MAAM,EAAErC,YAAY,CAACsC,GAAb,GAAmB9C,KAAK,CAAC0C,MAAN,GAAe,CAAlC,GAAsCrD,4BADzC;AAEL0D,IAAAA,IAAI,EAAEvC,YAAY,CAACwC,KAAb,GAAqBhD,KAAK,CAACyC,KAAN,GAAc,CAAnC,GAAuCrD,8BAFxC;AAGL0D,IAAAA,GAAG,EAAEtC,YAAY,CAACqC,MAAb,GAAsB7C,KAAK,CAAC0C,MAAN,GAAe,CAArC,GAAyCrD,4BAHzC;AAIL2D,IAAAA,KAAK,EAAExC,YAAY,CAACuC,IAAb,GAAoB/C,KAAK,CAACyC,KAAN,GAAc,CAAlC,GAAsCrD,8BAAtC,GAAuEE;AAJzE,GAAP;AAMD;;AAED,SAASiB,YAAT,CAAsBD,OAAtB,EAA+B;AAC7B,SAAO,CAAC,CAACA,OAAO,CAAC2C,SAAjB;AACD;;AAED,SAASV,eAAT,CAAyBH,QAAzB,EAAmC;AACjC,SAAOlD,IAAI,CAACkD,QAAD,EAAW,UAAS9B,OAAT,EAAkB;AACtC,WAAOxB,EAAE,CAACwB,OAAD,EAAU,kBAAV,CAAT;AACD,GAFU,CAAX;AAGD","sourcesContent":["import inherits from 'inherits';\n\nimport CommandInterceptor from 'diagram-js/lib/command/CommandInterceptor';\n\nimport { is } from '../../../util/ModelUtil';\n\nimport { isLabel } from '../../../util/LabelUtil';\n\nimport { getBBox } from 'diagram-js/lib/util/Elements';\n\nimport {\n  assign,\n  find\n} from 'min-dash';\n\nimport { asTRBL } from 'diagram-js/lib/layout/LayoutUtil';\n\nvar HORIZONTAL_PARTICIPANT_PADDING = 20,\n    VERTICAL_PARTICIPANT_PADDING = 20;\n\nexport var PARTICIPANT_BORDER_WIDTH = 30;\n\nvar HIGH_PRIORITY = 2000;\n\n\n/**\n * BPMN-specific behavior for creating participants.\n */\nexport default function CreateParticipantBehavior(canvas, eventBus, modeling) {\n  CommandInterceptor.call(this, eventBus);\n\n  // fit participant\n  eventBus.on([\n    'create.start',\n    'shape.move.start'\n  ], HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement();\n\n    if (!is(shape, 'bpmn:Participant') ||\n      !is(rootElement, 'bpmn:Process') ||\n      !rootElement.children.length) {\n      return;\n    }\n\n    // ignore connections, groups and labels\n    var children = rootElement.children.filter(function(element) {\n      return !is(element, 'bpmn:Group') &&\n        !isLabel(element) &&\n        !isConnection(element);\n    });\n\n    // ensure for available children to calculate bounds\n    if (!children.length) {\n      return;\n    }\n\n    var childrenBBox = getBBox(children);\n\n    var participantBounds = getParticipantBounds(shape, childrenBBox);\n\n    // assign width and height\n    assign(shape, participantBounds);\n\n    // assign create constraints\n    context.createConstraints = getParticipantCreateConstraints(shape, childrenBBox);\n  });\n\n  // force hovering process when creating first participant\n  eventBus.on('create.start', HIGH_PRIORITY, function(event) {\n    var context = event.context,\n        shape = context.shape,\n        rootElement = canvas.getRootElement(),\n        rootElementGfx = canvas.getGraphics(rootElement);\n\n    function ensureHoveringProcess(event) {\n      event.element = rootElement;\n      event.gfx = rootElementGfx;\n    }\n\n    if (is(shape, 'bpmn:Participant') && is(rootElement, 'bpmn:Process')) {\n      eventBus.on('element.hover', HIGH_PRIORITY, ensureHoveringProcess);\n\n      eventBus.once('create.cleanup', function() {\n        eventBus.off('element.hover', ensureHoveringProcess);\n      });\n    }\n  });\n\n  function ensureCollaboration(context) {\n    var parent = context.parent,\n        collaboration;\n\n    var rootElement = canvas.getRootElement();\n\n    if (is(rootElement, 'bpmn:Collaboration')) {\n      collaboration = rootElement;\n    } else {\n\n      // update root element by making collaboration\n      collaboration = modeling.makeCollaboration();\n\n      // re-use process when creating first participant\n      context.process = parent;\n    }\n\n    context.parent = collaboration;\n  }\n\n  // turn process into collaboration before adding participant\n  this.preExecute('shape.create', function(context) {\n    var parent = context.parent,\n        shape = context.shape;\n\n    if (is(shape, 'bpmn:Participant') && is(parent, 'bpmn:Process')) {\n      ensureCollaboration(context);\n    }\n  }, true);\n\n  this.execute('shape.create', function(context) {\n    var process = context.process,\n        shape = context.shape;\n\n    if (process) {\n      context.oldProcessRef = shape.businessObject.processRef;\n\n      // re-use process when creating first participant\n      shape.businessObject.processRef = process.businessObject;\n    }\n  }, true);\n\n  this.revert('shape.create', function(context) {\n    var process = context.process,\n        shape = context.shape;\n\n    if (process) {\n\n      // re-use process when creating first participant\n      shape.businessObject.processRef = context.oldProcessRef;\n    }\n  }, true);\n\n  this.postExecute('shape.create', function(context) {\n    var process = context.process,\n        shape = context.shape;\n\n    if (process) {\n\n      // move children from process to participant\n      var processChildren = process.children.slice();\n\n      modeling.moveElements(processChildren, { x: 0, y: 0 }, shape);\n    }\n\n  }, true);\n\n  // turn process into collaboration when creating participants\n  this.preExecute('elements.create', HIGH_PRIORITY, function(context) {\n    var elements = context.elements,\n        parent = context.parent,\n        participant;\n\n    var hasParticipants = findParticipant(elements);\n\n    if (hasParticipants && is(parent, 'bpmn:Process')) {\n      ensureCollaboration(context);\n\n      participant = findParticipant(elements);\n\n      context.oldProcessRef = participant.businessObject.processRef;\n\n      // re-use process when creating first participant\n      participant.businessObject.processRef = parent.businessObject;\n    }\n  }, true);\n\n  this.revert('elements.create', function(context) {\n    var elements = context.elements,\n        process = context.process,\n        participant;\n\n    if (process) {\n      participant = findParticipant(elements);\n\n      // re-use process when creating first participant\n      participant.businessObject.processRef = context.oldProcessRef;\n    }\n  }, true);\n\n  this.postExecute('elements.create', function(context) {\n    var elements = context.elements,\n        process = context.process,\n        participant;\n\n    if (process) {\n      participant = findParticipant(elements);\n\n      // move children from process to first participant\n      var processChildren = process.children.slice();\n\n      modeling.moveElements(processChildren, { x: 0, y: 0 }, participant);\n    }\n\n  }, true);\n\n}\n\nCreateParticipantBehavior.$inject = [\n  'canvas',\n  'eventBus',\n  'modeling'\n];\n\ninherits(CreateParticipantBehavior, CommandInterceptor);\n\n// helpers //////////\n\nfunction getParticipantBounds(shape, childrenBBox) {\n  childrenBBox = {\n    width: childrenBBox.width + HORIZONTAL_PARTICIPANT_PADDING * 2 + PARTICIPANT_BORDER_WIDTH,\n    height: childrenBBox.height + VERTICAL_PARTICIPANT_PADDING * 2\n  };\n\n  var width = Math.max(shape.width, childrenBBox.width),\n      height = Math.max(shape.height, childrenBBox.height);\n\n  return {\n    x: -width / 2,\n    y: -height / 2,\n    width: width,\n    height: height\n  };\n}\n\nfunction getParticipantCreateConstraints(shape, childrenBBox) {\n  childrenBBox = asTRBL(childrenBBox);\n\n  return {\n    bottom: childrenBBox.top + shape.height / 2 - VERTICAL_PARTICIPANT_PADDING,\n    left: childrenBBox.right - shape.width / 2 + HORIZONTAL_PARTICIPANT_PADDING,\n    top: childrenBBox.bottom - shape.height / 2 + VERTICAL_PARTICIPANT_PADDING,\n    right: childrenBBox.left + shape.width / 2 - HORIZONTAL_PARTICIPANT_PADDING - PARTICIPANT_BORDER_WIDTH\n  };\n}\n\nfunction isConnection(element) {\n  return !!element.waypoints;\n}\n\nfunction findParticipant(elements) {\n  return find(elements, function(element) {\n    return is(element, 'bpmn:Participant');\n  });\n}"]},"metadata":{},"sourceType":"module"}