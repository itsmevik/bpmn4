{"ast":null,"code":"import { assign, forEach, isArray } from 'min-dash';\nimport { is } from '../../util/ModelUtil';\nimport { isExpanded, isEventSubProcess } from '../../util/DiUtil';\nimport { isAny } from '../modeling/util/ModelingUtil';\nimport { getChildLanes } from '../modeling/util/LaneUtil';\nimport { hasPrimaryModifier } from 'diagram-js/lib/util/Mouse';\n/**\n * A provider for BPMN 2.0 elements context pad\n */\n\nexport default function ContextPadProvider(config, injector, eventBus, contextPad, modeling, elementFactory, connect, create, popupMenu, canvas, rules, translate) {\n  config = config || {};\n  contextPad.registerProvider(this);\n  this._contextPad = contextPad;\n  this._modeling = modeling;\n  this._elementFactory = elementFactory;\n  this._connect = connect;\n  this._create = create;\n  this._popupMenu = popupMenu;\n  this._canvas = canvas;\n  this._rules = rules;\n  this._translate = translate;\n\n  if (config.autoPlace !== false) {\n    this._autoPlace = injector.get('autoPlace', false);\n  }\n\n  eventBus.on('create.end', 250, function (event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (!hasPrimaryModifier(event) || !contextPad.isOpen(shape)) {\n      return;\n    }\n\n    var entries = contextPad.getEntries(shape);\n\n    if (entries.replace) {\n      entries.replace.action.click(event, shape);\n    }\n  });\n}\nContextPadProvider.$inject = ['config.contextPad', 'injector', 'eventBus', 'contextPad', 'modeling', 'elementFactory', 'connect', 'create', 'popupMenu', 'canvas', 'rules', 'translate'];\n\nContextPadProvider.prototype.getContextPadEntries = function (element) {\n  var contextPad = this._contextPad,\n      modeling = this._modeling,\n      elementFactory = this._elementFactory,\n      connect = this._connect,\n      create = this._create,\n      popupMenu = this._popupMenu,\n      canvas = this._canvas,\n      rules = this._rules,\n      autoPlace = this._autoPlace,\n      translate = this._translate;\n  var actions = {};\n\n  if (element.type === 'label') {\n    return actions;\n  }\n\n  var businessObject = element.businessObject;\n\n  function startConnect(event, element) {\n    connect.start(event, element);\n  }\n\n  function removeElement(e) {\n    modeling.removeElements([element]);\n  }\n\n  function getReplaceMenuPosition(element) {\n    var Y_OFFSET = 5;\n    var diagramContainer = canvas.getContainer(),\n        pad = contextPad.getPad(element).html;\n    var diagramRect = diagramContainer.getBoundingClientRect(),\n        padRect = pad.getBoundingClientRect();\n    var top = padRect.top - diagramRect.top;\n    var left = padRect.left - diagramRect.left;\n    var pos = {\n      x: left,\n      y: top + padRect.height + Y_OFFSET\n    };\n    return pos;\n  }\n  /**\n   * Create an append action\n   *\n   * @param {String} type\n   * @param {String} className\n   * @param {String} [title]\n   * @param {Object} [options]\n   *\n   * @return {Object} descriptor\n   */\n\n\n  function appendAction(type, className, title, options) {\n    if (typeof title !== 'string') {\n      options = title;\n      title = translate('Append {type}', {\n        type: type.replace(/^bpmn:/, '')\n      });\n    }\n\n    function appendStart(event, element) {\n      var shape = elementFactory.createShape(assign({\n        type: type\n      }, options));\n      create.start(event, shape, {\n        source: element\n      });\n    }\n\n    var append = autoPlace ? function (event, element) {\n      var shape = elementFactory.createShape(assign({\n        type: type\n      }, options));\n      autoPlace.append(element, shape);\n    } : appendStart;\n    return {\n      group: 'model',\n      className: className,\n      title: title,\n      action: {\n        dragstart: appendStart,\n        click: append\n      }\n    };\n  }\n\n  function splitLaneHandler(count) {\n    return function (event, element) {\n      // actual split\n      modeling.splitLane(element, count); // refresh context pad after split to\n      // get rid of split icons\n\n      contextPad.open(element, true);\n    };\n  }\n\n  if (isAny(businessObject, ['bpmn:Lane', 'bpmn:Participant']) && isExpanded(businessObject)) {\n    var childLanes = getChildLanes(element);\n    assign(actions, {\n      'lane-insert-above': {\n        group: 'lane-insert-above',\n        className: 'bpmn-icon-lane-insert-above',\n        title: translate('Add Lane above'),\n        action: {\n          click: function click(event, element) {\n            modeling.addLane(element, 'top');\n          }\n        }\n      }\n    });\n\n    if (childLanes.length < 2) {\n      if (element.height >= 120) {\n        assign(actions, {\n          'lane-divide-two': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-two',\n            title: translate('Divide into two Lanes'),\n            action: {\n              click: splitLaneHandler(2)\n            }\n          }\n        });\n      }\n\n      if (element.height >= 180) {\n        assign(actions, {\n          'lane-divide-three': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-three',\n            title: translate('Divide into three Lanes'),\n            action: {\n              click: splitLaneHandler(3)\n            }\n          }\n        });\n      }\n    }\n\n    assign(actions, {\n      'lane-insert-below': {\n        group: 'lane-insert-below',\n        className: 'bpmn-icon-lane-insert-below',\n        title: translate('Add Lane below'),\n        action: {\n          click: function click(event, element) {\n            modeling.addLane(element, 'bottom');\n          }\n        }\n      }\n    });\n  }\n\n  if (is(businessObject, 'bpmn:FlowNode')) {\n    if (is(businessObject, 'bpmn:EventBasedGateway')) {\n      assign(actions, {\n        'append.receive-task': appendAction('bpmn:ReceiveTask', 'bpmn-icon-receive-task', translate('Append ReceiveTask')),\n        'append.message-intermediate-event': appendAction('bpmn:IntermediateCatchEvent', 'bpmn-icon-intermediate-event-catch-message', translate('Append MessageIntermediateCatchEvent'), {\n          eventDefinitionType: 'bpmn:MessageEventDefinition'\n        }),\n        'append.timer-intermediate-event': appendAction('bpmn:IntermediateCatchEvent', 'bpmn-icon-intermediate-event-catch-timer', translate('Append TimerIntermediateCatchEvent'), {\n          eventDefinitionType: 'bpmn:TimerEventDefinition'\n        }),\n        'append.condition-intermediate-event': appendAction('bpmn:IntermediateCatchEvent', 'bpmn-icon-intermediate-event-catch-condition', translate('Append ConditionIntermediateCatchEvent'), {\n          eventDefinitionType: 'bpmn:ConditionalEventDefinition'\n        }),\n        'append.signal-intermediate-event': appendAction('bpmn:IntermediateCatchEvent', 'bpmn-icon-intermediate-event-catch-signal', translate('Append SignalIntermediateCatchEvent'), {\n          eventDefinitionType: 'bpmn:SignalEventDefinition'\n        })\n      });\n    } else if (isEventType(businessObject, 'bpmn:BoundaryEvent', 'bpmn:CompensateEventDefinition')) {\n      assign(actions, {\n        'append.compensation-activity': appendAction('bpmn:Task', 'bpmn-icon-task', translate('Append compensation activity'), {\n          isForCompensation: true\n        })\n      });\n    } else if (!is(businessObject, 'bpmn:EndEvent') && !businessObject.isForCompensation && !isEventType(businessObject, 'bpmn:IntermediateThrowEvent', 'bpmn:LinkEventDefinition') && !isEventSubProcess(businessObject)) {\n      assign(actions, {\n        'append.end-event': appendAction('bpmn:EndEvent', 'bpmn-icon-end-event-none', translate('Append EndEvent')),\n        'append.gateway': appendAction('bpmn:ExclusiveGateway', 'bpmn-icon-gateway-none', translate('Append Gateway')),\n        'append.append-task': appendAction('bpmn:Task', 'bpmn-icon-task', translate('Append Task')),\n        'append.intermediate-event': appendAction('bpmn:IntermediateThrowEvent', 'bpmn-icon-intermediate-event-none', translate('Append Intermediate/Boundary Event'))\n      });\n    }\n  }\n\n  if (!popupMenu.isEmpty(element, 'bpmn-replace')) {\n    // Replace menu entry\n    assign(actions, {\n      'replace': {\n        group: 'edit',\n        className: 'bpmn-icon-screw-wrench',\n        title: translate('Change type'),\n        action: {\n          click: function click(event, element) {\n            var position = assign(getReplaceMenuPosition(element), {\n              cursor: {\n                x: event.x,\n                y: event.y\n              }\n            });\n            popupMenu.open(element, 'bpmn-replace', position);\n          }\n        }\n      }\n    });\n  }\n\n  if (isAny(businessObject, ['bpmn:FlowNode', 'bpmn:InteractionNode', 'bpmn:DataObjectReference', 'bpmn:DataStoreReference'])) {\n    assign(actions, {\n      'append.text-annotation': appendAction('bpmn:TextAnnotation', 'bpmn-icon-text-annotation'),\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using ' + (businessObject.isForCompensation ? '' : 'Sequence/MessageFlow or ') + 'Association'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect\n        }\n      }\n    });\n  }\n\n  if (isAny(businessObject, ['bpmn:DataObjectReference', 'bpmn:DataStoreReference'])) {\n    assign(actions, {\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using DataInputAssociation'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect\n        }\n      }\n    });\n  } // delete element entry, only show if allowed by rules\n\n\n  var deleteAllowed = rules.allowed('elements.delete', {\n    elements: [element]\n  });\n\n  if (isArray(deleteAllowed)) {\n    // was the element returned as a deletion candidate?\n    deleteAllowed = deleteAllowed[0] === element;\n  }\n\n  if (deleteAllowed) {\n    assign(actions, {\n      'delete': {\n        group: 'edit',\n        className: 'bpmn-icon-trash',\n        title: translate('Remove'),\n        action: {\n          click: removeElement\n        }\n      }\n    });\n  }\n\n  return actions;\n}; // helpers /////////\n\n\nfunction isEventType(eventBo, type, definition) {\n  var isType = eventBo.$instanceOf(type);\n  var isDefinition = false;\n  var definitions = eventBo.eventDefinitions || [];\n  forEach(definitions, function (def) {\n    if (def.$type === definition) {\n      isDefinition = true;\n    }\n  });\n  return isType && isDefinition;\n}","map":{"version":3,"sources":["/Users/believecreative/Kumar/bpmn/node_modules/bpmn-js/lib/features/context-pad/ContextPadProvider.js"],"names":["assign","forEach","isArray","is","isExpanded","isEventSubProcess","isAny","getChildLanes","hasPrimaryModifier","ContextPadProvider","config","injector","eventBus","contextPad","modeling","elementFactory","connect","create","popupMenu","canvas","rules","translate","registerProvider","_contextPad","_modeling","_elementFactory","_connect","_create","_popupMenu","_canvas","_rules","_translate","autoPlace","_autoPlace","get","on","event","context","shape","isOpen","entries","getEntries","replace","action","click","$inject","prototype","getContextPadEntries","element","actions","type","businessObject","startConnect","start","removeElement","e","removeElements","getReplaceMenuPosition","Y_OFFSET","diagramContainer","getContainer","pad","getPad","html","diagramRect","getBoundingClientRect","padRect","top","left","pos","x","y","height","appendAction","className","title","options","appendStart","createShape","source","append","group","dragstart","splitLaneHandler","count","splitLane","open","childLanes","addLane","length","eventDefinitionType","isEventType","isForCompensation","isEmpty","position","cursor","deleteAllowed","allowed","elements","eventBo","definition","isType","$instanceOf","isDefinition","definitions","eventDefinitions","def","$type"],"mappings":"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","sourcesContent":["import {\n  assign,\n  forEach,\n  isArray\n} from 'min-dash';\n\nimport {\n  is\n} from '../../util/ModelUtil';\n\nimport {\n  isExpanded,\n  isEventSubProcess\n} from '../../util/DiUtil';\n\nimport {\n  isAny\n} from '../modeling/util/ModelingUtil';\n\nimport {\n  getChildLanes\n} from '../modeling/util/LaneUtil';\n\nimport {\n  hasPrimaryModifier\n} from 'diagram-js/lib/util/Mouse';\n\n\n/**\n * A provider for BPMN 2.0 elements context pad\n */\nexport default function ContextPadProvider(\n    config, injector, eventBus,\n    contextPad, modeling, elementFactory,\n    connect, create, popupMenu,\n    canvas, rules, translate) {\n\n  config = config || {};\n\n  contextPad.registerProvider(this);\n\n  this._contextPad = contextPad;\n\n  this._modeling = modeling;\n\n  this._elementFactory = elementFactory;\n  this._connect = connect;\n  this._create = create;\n  this._popupMenu = popupMenu;\n  this._canvas = canvas;\n  this._rules = rules;\n  this._translate = translate;\n\n  if (config.autoPlace !== false) {\n    this._autoPlace = injector.get('autoPlace', false);\n  }\n\n  eventBus.on('create.end', 250, function(event) {\n    var context = event.context,\n        shape = context.shape;\n\n    if (!hasPrimaryModifier(event) || !contextPad.isOpen(shape)) {\n      return;\n    }\n\n    var entries = contextPad.getEntries(shape);\n\n    if (entries.replace) {\n      entries.replace.action.click(event, shape);\n    }\n  });\n}\n\nContextPadProvider.$inject = [\n  'config.contextPad',\n  'injector',\n  'eventBus',\n  'contextPad',\n  'modeling',\n  'elementFactory',\n  'connect',\n  'create',\n  'popupMenu',\n  'canvas',\n  'rules',\n  'translate'\n];\n\n\nContextPadProvider.prototype.getContextPadEntries = function(element) {\n\n  var contextPad = this._contextPad,\n      modeling = this._modeling,\n\n      elementFactory = this._elementFactory,\n      connect = this._connect,\n      create = this._create,\n      popupMenu = this._popupMenu,\n      canvas = this._canvas,\n      rules = this._rules,\n      autoPlace = this._autoPlace,\n      translate = this._translate;\n\n  var actions = {};\n\n  if (element.type === 'label') {\n    return actions;\n  }\n\n  var businessObject = element.businessObject;\n\n  function startConnect(event, element) {\n    connect.start(event, element);\n  }\n\n  function removeElement(e) {\n    modeling.removeElements([ element ]);\n  }\n\n  function getReplaceMenuPosition(element) {\n\n    var Y_OFFSET = 5;\n\n    var diagramContainer = canvas.getContainer(),\n        pad = contextPad.getPad(element).html;\n\n    var diagramRect = diagramContainer.getBoundingClientRect(),\n        padRect = pad.getBoundingClientRect();\n\n    var top = padRect.top - diagramRect.top;\n    var left = padRect.left - diagramRect.left;\n\n    var pos = {\n      x: left,\n      y: top + padRect.height + Y_OFFSET\n    };\n\n    return pos;\n  }\n\n\n  /**\n   * Create an append action\n   *\n   * @param {String} type\n   * @param {String} className\n   * @param {String} [title]\n   * @param {Object} [options]\n   *\n   * @return {Object} descriptor\n   */\n  function appendAction(type, className, title, options) {\n\n    if (typeof title !== 'string') {\n      options = title;\n      title = translate('Append {type}', { type: type.replace(/^bpmn:/, '') });\n    }\n\n    function appendStart(event, element) {\n\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n      create.start(event, shape, {\n        source: element\n      });\n    }\n\n\n    var append = autoPlace ? function(event, element) {\n      var shape = elementFactory.createShape(assign({ type: type }, options));\n\n      autoPlace.append(element, shape);\n    } : appendStart;\n\n\n    return {\n      group: 'model',\n      className: className,\n      title: title,\n      action: {\n        dragstart: appendStart,\n        click: append\n      }\n    };\n  }\n\n  function splitLaneHandler(count) {\n\n    return function(event, element) {\n\n      // actual split\n      modeling.splitLane(element, count);\n\n      // refresh context pad after split to\n      // get rid of split icons\n      contextPad.open(element, true);\n    };\n  }\n\n\n  if (isAny(businessObject, [ 'bpmn:Lane', 'bpmn:Participant' ]) && isExpanded(businessObject)) {\n\n    var childLanes = getChildLanes(element);\n\n    assign(actions, {\n      'lane-insert-above': {\n        group: 'lane-insert-above',\n        className: 'bpmn-icon-lane-insert-above',\n        title: translate('Add Lane above'),\n        action: {\n          click: function(event, element) {\n            modeling.addLane(element, 'top');\n          }\n        }\n      }\n    });\n\n    if (childLanes.length < 2) {\n\n      if (element.height >= 120) {\n        assign(actions, {\n          'lane-divide-two': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-two',\n            title: translate('Divide into two Lanes'),\n            action: {\n              click: splitLaneHandler(2)\n            }\n          }\n        });\n      }\n\n      if (element.height >= 180) {\n        assign(actions, {\n          'lane-divide-three': {\n            group: 'lane-divide',\n            className: 'bpmn-icon-lane-divide-three',\n            title: translate('Divide into three Lanes'),\n            action: {\n              click: splitLaneHandler(3)\n            }\n          }\n        });\n      }\n    }\n\n    assign(actions, {\n      'lane-insert-below': {\n        group: 'lane-insert-below',\n        className: 'bpmn-icon-lane-insert-below',\n        title: translate('Add Lane below'),\n        action: {\n          click: function(event, element) {\n            modeling.addLane(element, 'bottom');\n          }\n        }\n      }\n    });\n\n  }\n\n  if (is(businessObject, 'bpmn:FlowNode')) {\n\n    if (is(businessObject, 'bpmn:EventBasedGateway')) {\n\n      assign(actions, {\n        'append.receive-task': appendAction(\n          'bpmn:ReceiveTask',\n          'bpmn-icon-receive-task',\n          translate('Append ReceiveTask')\n        ),\n        'append.message-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-message',\n          translate('Append MessageIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:MessageEventDefinition' }\n        ),\n        'append.timer-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-timer',\n          translate('Append TimerIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:TimerEventDefinition' }\n        ),\n        'append.condition-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-condition',\n          translate('Append ConditionIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:ConditionalEventDefinition' }\n        ),\n        'append.signal-intermediate-event': appendAction(\n          'bpmn:IntermediateCatchEvent',\n          'bpmn-icon-intermediate-event-catch-signal',\n          translate('Append SignalIntermediateCatchEvent'),\n          { eventDefinitionType: 'bpmn:SignalEventDefinition' }\n        )\n      });\n    } else\n\n    if (isEventType(businessObject, 'bpmn:BoundaryEvent', 'bpmn:CompensateEventDefinition')) {\n\n      assign(actions, {\n        'append.compensation-activity':\n            appendAction(\n              'bpmn:Task',\n              'bpmn-icon-task',\n              translate('Append compensation activity'),\n              {\n                isForCompensation: true\n              }\n            )\n      });\n    } else\n\n    if (!is(businessObject, 'bpmn:EndEvent') &&\n        !businessObject.isForCompensation &&\n        !isEventType(businessObject, 'bpmn:IntermediateThrowEvent', 'bpmn:LinkEventDefinition') &&\n        !isEventSubProcess(businessObject)) {\n\n      assign(actions, {\n        'append.end-event': appendAction(\n          'bpmn:EndEvent',\n          'bpmn-icon-end-event-none',\n          translate('Append EndEvent')\n        ),\n        'append.gateway': appendAction(\n          'bpmn:ExclusiveGateway',\n          'bpmn-icon-gateway-none',\n          translate('Append Gateway')\n        ),\n        'append.append-task': appendAction(\n          'bpmn:Task',\n          'bpmn-icon-task',\n          translate('Append Task')\n        ),\n        'append.intermediate-event': appendAction(\n          'bpmn:IntermediateThrowEvent',\n          'bpmn-icon-intermediate-event-none',\n          translate('Append Intermediate/Boundary Event')\n        )\n      });\n    }\n  }\n\n  if (!popupMenu.isEmpty(element, 'bpmn-replace')) {\n\n    // Replace menu entry\n    assign(actions, {\n      'replace': {\n        group: 'edit',\n        className: 'bpmn-icon-screw-wrench',\n        title: translate('Change type'),\n        action: {\n          click: function(event, element) {\n\n            var position = assign(getReplaceMenuPosition(element), {\n              cursor: { x: event.x, y: event.y }\n            });\n\n            popupMenu.open(element, 'bpmn-replace', position);\n          }\n        }\n      }\n    });\n  }\n\n  if (isAny(businessObject, [\n    'bpmn:FlowNode',\n    'bpmn:InteractionNode',\n    'bpmn:DataObjectReference',\n    'bpmn:DataStoreReference'\n  ])) {\n\n    assign(actions, {\n      'append.text-annotation': appendAction('bpmn:TextAnnotation', 'bpmn-icon-text-annotation'),\n\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using ' +\n                  (businessObject.isForCompensation ? '' : 'Sequence/MessageFlow or ') +\n                  'Association'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect\n        }\n      }\n    });\n  }\n\n  if (isAny(businessObject, [ 'bpmn:DataObjectReference', 'bpmn:DataStoreReference' ])) {\n    assign(actions, {\n      'connect': {\n        group: 'connect',\n        className: 'bpmn-icon-connection-multi',\n        title: translate('Connect using DataInputAssociation'),\n        action: {\n          click: startConnect,\n          dragstart: startConnect\n        }\n      }\n    });\n  }\n\n  // delete element entry, only show if allowed by rules\n  var deleteAllowed = rules.allowed('elements.delete', { elements: [ element ] });\n\n  if (isArray(deleteAllowed)) {\n\n    // was the element returned as a deletion candidate?\n    deleteAllowed = deleteAllowed[0] === element;\n  }\n\n  if (deleteAllowed) {\n    assign(actions, {\n      'delete': {\n        group: 'edit',\n        className: 'bpmn-icon-trash',\n        title: translate('Remove'),\n        action: {\n          click: removeElement\n        }\n      }\n    });\n  }\n\n  return actions;\n};\n\n\n// helpers /////////\n\nfunction isEventType(eventBo, type, definition) {\n\n  var isType = eventBo.$instanceOf(type);\n  var isDefinition = false;\n\n  var definitions = eventBo.eventDefinitions || [];\n  forEach(definitions, function(def) {\n    if (def.$type === definition) {\n      isDefinition = true;\n    }\n  });\n\n  return isType && isDefinition;\n}\n"]},"metadata":{},"sourceType":"module"}